<dml>
<submodulo id="catalogos">
 <select id="RfTrCuentasBancarias">
select 
  ID_CUENTA,NUM_CUENTA,ENTIDAD,ID_BANCO,NOMBRE_CTA,UNIDAD_EJECUTORA,ID_TIPO_CTA,ID_TIPO_PROGRAMA,OPERACION_CENTRAL,ID_ESTATUS_CTA_PROG,AMBITO,PROCESAR,FECHA_OPERACION,FECHA_FIN_OPERACION 
from 
  RF_TR_CUENTAS_BANCARIAS 
where 
  :tipoCuenta 
order by unidad_ejecutora, ambito
</select> 
</submodulo>
<submodulo id="criterios">
<select id="cuentasAdicionales">
select 
  id_cuenta 
from 
  RF_TR_USUARIOS_CUENTAS 
where 
  login = ':login'
</select>
<select id="ultimaFechaCargada">
select 
  max(trunc(fecha_movimientos)) fecha  
from 
  RF_TR_BITACORA_ACTUALIZACION  
where 
  id_tipo_programa = :idPrograma or id_tipo_programa = decode(:idPrograma,9,7,:idPrograma)
</select>
</submodulo>
<submodulo id="reportes">
<select id="ChqsSalvoBuenCobro">
select 
 tsr.obten_siguiente_dia_habil(tm.descripcion, trunc(tm.fecha_hora))as dias, 
 cb.num_cuenta, 
 decode(cb.id_tipo_cta,6,cb.nombre_cta || ' ' || tc.nombre_corto,cb.nombre_cta) nombre_cta, 
 tm.descripcion, 
 to_char(tm.fecha_hora,'dd/MM/yyyy') fecha_hora,
 tm.monto 
from 
 (select id_cuenta, fecha_hora, monto, descripcion, clave_trans_recla, id_clave_trans_recla, id_movimiento 
  from 
     rf_tr_movimientos_cuenta 
  where 
   (id_cuenta in (:idCuentas)) and
   fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
    id_clave_trans_recla  = 2 
  order by 
    id_cuenta, fecha_hora) tm, rf_tr_cuentas_bancarias cb,  RF_TC_TIPO_CUENTA tc 
  where tm.id_cuenta = cb.id_cuenta  
        and cb.id_tipo_cta = tc.id_tipo_cta 
order by 
 tm.fecha_hora 
</select>
<select id="RendimientosGlobal">
select 
  ren.totalrendimientos, ren.totalcuentas, descripcion 
from 
  (select 
    nvl(SUM(mc.rendimientos),0) AS totalrendimientos, COUNT(cb.unidad_ejecutora) AS totalcuentas, cb.unidad_ejecutora 
   from 
    (select 
       ambito, entidad, id_cuenta, id_tipo_programa, num_cuenta,
       decode(num_cuenta,    '4042105379',    '106',    '4042105361',    '113',    '4042105353',    '108',    
                             '4025861329',    '101',    '4042105346',    '105',    '4040418089',    '101',    
                             '4042105338',    '107',    '4042105312',    '101',    '4042105304',    '101',    
                             '4042547786',    '101',    '4042547844',    '101',    '4025861311',    '101',    
                             '4024426579',    '101',    '4042986018',    '109',    '4024426090',    '109',    
                             '4040444184',    '109',    '4039477765',    '109',    '4024114555',    '109',    unidad_ejecutora) unidad_ejecutora 
     from 
      rf_tr_cuentas_bancarias 
     where 
      id_cuenta IN (:idCuentas)
      AND((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR fecha_fin_operacion IS NULL)))
    and id_tipo_cta !=8 and id_tipo_programa in (1,6)  
    ) cb 
  left join 
    (select 
       mvc.id_cuenta, SUM(mvc.monto) AS rendimientos 
     from 
       rf_tr_movimientos_cuenta mvc, rf_tr_cuentas_bancarias ctb 
     where 
      mvc.id_cuenta = ctb.id_cuenta AND
      fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
     AND (mvc.id_clave_trans_recla = 47 OR mvc.id_clave_trans_recla = 69 OR mvc.id_clave_trans_recla = 177) AND mvc.descripcion LIKE '%INT%' 
     group by mvc.id_cuenta) mc
   on cb.id_cuenta = mc.id_cuenta 
   inner join 
     rf_tc_unidades_ejecutoras_tece ue 
   ON cb.unidad_ejecutora = ue.unidad_ejecutora 
      AND cb.entidad = ue.entidad 
      AND cb.ambito = ue.ambito 
   group by 
    cb.unidad_ejecutora) ren, rh_tc_uni_ejecutoras ue_rh 
where  
   ren.unidad_ejecutora = ue_rh.unidad_ejecutora
</select>
<select id="RendimientosGlobalBMX">
select 
  ren.totalrendimientos, ren.totalcuentas, upper(decode(descripcion,'Oficina del C. Presidente','Junta de Gobierno y Presidencia','ORGANO INTERNO DE CONTROL','Contraloria Interna',descripcion)) descripcion, decode(ren.unidad_ejecutora,'901','0901','902','0902',ren.unidad_ejecutora) unidad_ejecutora   
from 
  (select 
    nvl(SUM(mc.rendimientos),0) AS totalrendimientos, COUNT(cb.unidad_ejecutora) AS totalcuentas, cb.unidad_ejecutora 
   from 
    (select 
       id_cuenta, id_tipo_programa, 
       decode(ambito, '43710154377',1,'43710155101',1,'43710155098',1,'43710155071',1,'43710155063',1,'43710154857',1,'43710154741',1,
                      '43710154725',1,'43710154547',1,'43710154431',1,ambito) ambito,
       decode(num_cuenta,'43710154377',1,'43710155101',1,'43710155098',1,'43710155071',1,'43710155063',1,'43710154857',1,'43710154741',1,
                         '43710154725',1,'43710154547',1,'43710154431',1,
                         '43710149845',1, entidad) entidad,
       decode(num_cuenta,'43710154369','902','08400029068','901','43710149845','901','08400029076','901',
                         '08400029084','901','08400029092','901','08400030457','901',
                         '08400029122','902','08400029114','902','08400029106','902','08400029386','902',
                         '43710154377','902','43710154431','902','43710154547','902','43710154725','902',  
                         '43710154741','902','43710154857','902','43710155063','902','43710155071','902',  
                         '43710155098','902','43710155101','902',unidad_ejecutora) unidad_ejecutora
     from 
      rf_tr_cuentas_bancarias 
     where 
    id_cuenta IN (:idCuentas)
    AND((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR fecha_fin_operacion IS NULL)))
   and id_tipo_cta !=8 and  id_tipo_programa in (7,1)
   ) cb 
  left join 
    (select 
       mvc.id_cuenta, SUM(mvc.monto) AS rendimientos 
     from 
       rf_tr_movimientos_cuenta mvc, rf_tr_cuentas_bancarias ctb, RF_TC_CLAVES_TRANSACCION ct
     where 
      mvc.id_cuenta = ctb.id_cuenta AND
      fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
      AND mvc.id_clave_trans_recla = ct.id_clave_trans and
          (ct.id_clave_tb = 55) and 
          mvc.id_cuenta in (:idCuentas)
     group by mvc.id_cuenta) mc
   on cb.id_cuenta = mc.id_cuenta 
 inner join 
     (select unidad_ejecutora, entidad, ambito, descripcion
                            from rf_tc_unidades_ejecutoras_tece ut
                            union all
                            select unidad_ejecutora, entidad, ambito, descripcion
                            from RF_TC_CLASIFICA_UNIDADES) ue 
  ON cb.unidad_ejecutora = ue.unidad_ejecutora AND cb.entidad = ue.entidad 
  group by 
    cb.unidad_ejecutora) ren 
inner join 
 (select unidad_ejecutora, descripcion
                            from sia_admin.rh_tc_uni_ejecutoras ut
                            union all
                            select unidad_ejecutora,  descripcion
                            from RF_TC_CLASIFICA_UNIDADES) ue_rh 
on ren.unidad_ejecutora = ue_rh.unidad_ejecutora 
order by unidad_ejecutora
</select>
<select id="RendimientosGlobalEsp">
select   
  ren.totalrendimientos, ren.totalcuentas, upper(decode(descripcion,
  'Oficina del C. Presidente','Junta de Gobierno y Presidencia','ORGANO INTERNO DE CONTROL','Contraloria Interna',descripcion)) descripcion, 
   ren.unidad_ejecutora
from 
  (select 
    nvl(SUM(mc.rendimientos),0) AS totalrendimientos, COUNT(cb.unidad_ejecutora) AS totalcuentas, cb.unidad_ejecutora 
   from 
    (select 
       id_cuenta, id_tipo_programa, ambito, entidad, unidad_ejecutora
     from 
      rf_tr_cuentas_bancarias 
     where 
      id_cuenta IN (:idCuentas)
    AND((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR fecha_fin_operacion IS NULL)))
   and id_tipo_cta !=8 and id_tipo_programa =9
   ) cb 
  left join 
    (select 
       mvc.id_cuenta, SUM(mvc.monto) AS rendimientos 
     from 
       rf_tr_movimientos_cuenta mvc, rf_tr_cuentas_bancarias ctb, RF_TC_CLAVES_TRANSACCION ct
     where 
      mvc.id_cuenta = ctb.id_cuenta AND
      fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
      AND mvc.id_clave_trans_recla = ct.id_clave_trans and
          (ct.id_clave_tb = 55)   and mvc.id_cuenta in (:idCuentas)
     group by mvc.id_cuenta) mc
   on cb.id_cuenta = mc.id_cuenta 
 inner join 
     (select unidad_ejecutora, entidad, ambito, descripcion
                            from rf_tc_unidades_ejecutoras_tece ut
                            union all
                            select unidad_ejecutora, entidad, ambito, descripcion
                            from RF_TC_CLASIFICA_UNIDADES) ue 
  ON cb.unidad_ejecutora = ue.unidad_ejecutora 
   AND cb.entidad = ue.entidad  
   group by 
    cb.unidad_ejecutora) ren 
inner join 
 (select unidad_ejecutora, descripcion
                            from rh_tc_uni_ejecutoras ut
                            union all
                            select unidad_ejecutora,  descripcion
                            from RF_TC_CLASIFICA_UNIDADES) ue_rh 
on ren.unidad_ejecutora = ue_rh.unidad_ejecutora 
order by unidad_ejecutora
</select>
<select id="RendimientoGlobalGral">
select 
  ren.totalrendimientos, ren.totalcuentas, descripcion 
from 
  (select 
    nvl(SUM(mc.rendimientos),0) AS totalrendimientos, COUNT(cb.unidad_ejecutora) AS totalcuentas, cb.unidad_ejecutora 
   from 
    (select 
       ambito, entidad, id_cuenta, id_tipo_programa,unidad_ejecutora 
     from 
      rf_tr_cuentas_bancarias 
     where 
      id_cuenta IN (:idCuentas)
      AND((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion >= to_date(':fechaFinal','yyyy-mm-dd')) OR fecha_fin_operacion IS NULL) OR 
        (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR fecha_fin_operacion IS NULL)))
    and id_tipo_cta !=8 and id_tipo_programa = :programa   
    ) cb 
  left join 
    (select 
       mvc.id_cuenta, SUM(mvc.monto) AS rendimientos 
     from 
       rf_tr_movimientos_cuenta mvc, rf_tr_cuentas_bancarias ctb 
     where 
      mvc.id_cuenta = ctb.id_cuenta AND
      fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
      :clave 
     group by mvc.id_cuenta) 
  mc on cb.id_cuenta = mc.id_cuenta 
   inner join 
     rf_tc_unidades_ejecutoras_tece ue ON cb.unidad_ejecutora = ue.unidad_ejecutora 
   AND cb.entidad = ue.entidad 
   AND cb.ambito = ue.ambito 
   group by 
    cb.unidad_ejecutora) ren,  rh_tc_uni_ejecutoras ue_rh 
  where 
      ren.unidad_ejecutora = ue_rh.unidad_ejecutora
</select>
<select id="ComIndebidasChq">
select 
 cb.num_cuenta, cb.nombre_cta, to_char(mc.fecha_hora,'dd/mm/yyyy') fecha_hora, mc.clave_trans_recla, mc.descripcion, mc.monto 
from 
 (select 
   id_cuenta, fecha_hora, monto, descripcion, clave_trans_recla, id_clave_trans_recla 
  from 
   RF_TR_MOVIMIENTOS_CUENTA 
  where 
   (id_cuenta in (:idCuentas)) and 
   trunc(fecha_hora) >= to_date (':fechaInicial','yyyy-mm-dd') AND  trunc(fecha_hora) &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
   ((id_clave_trans_recla = 37 or id_clave_trans_recla = 31) and (descripcion LIKE '%CAJA%' ))) mc, RF_TR_CUENTAS_BANCARIAS cb, 
    RF_TC_COSTOS_TRANSACCION ct   
where 
  cb.id_cuenta = mc.id_cuenta  and mc.id_clave_trans_recla = ct.id_clave_trans and ct.costo &lt; mc.monto  
order by 
   num_cuenta, fecha_hora 
</select>
<select id="TerminalPuntoVta">
select 
    c.descripcion, to_char(c.fecha_hora,'dd/MM/yyyy') fecha_hora, c.monto, ue.descripcion || '  ' || tpv.descripcion unidad, ue.unidad_ejecutora  
from 
    rf_tr_movimientos_cuenta c , rf_tc_cuentas_tpv tpv, rf_tc_unidades_ejecutoras_tece ue  
where 
    fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
    id_clave_trans_recla  = 49 and tpv.referencia_tpv = substr(trim(c.descripcion),-7,7) and
    tpv.unidad_ejecutora in (select distinct c.unidad_ejecutora
                            from rf_tr_cuentas_bancarias c
                            where c.id_cuenta  in (:idCuentas)) and 
    ue.UNIDAD_EJECUTORA = tpv.UNIDAD_EJECUTORA and 
    ue.entidad = tpv.entidad and 
    ue.ambito = tpv.ambito and 
    (ue.unidad_ejecutora,ue.entidad, ue.ambito) in 
    (select distinct c.unidad_ejecutora, entidad, ambito
     from rf_tr_cuentas_bancarias c
     where c.id_cuenta  in (:idCuentas))  
order by 
  ue.unidad_ejecutora, unidad, c.fecha_hora 
</select>
<select id="TerminalPuntoVtaBMX">
select 
    c.descripcion, to_char(c.fecha_hora,'dd/MM/yyyy') fecha_hora, c.monto, ue.descripcion || '  ' || tpv.descripcion || ' (' || tpv.referencia_tpv || ')'  unidad, ue.unidad_ejecutora  
from 
    rf_tr_movimientos_cuenta c , rf_tc_cuentas_tpv tpv, rf_tc_unidades_ejecutoras_tece ue  
where 
    fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
    id_clave_trans_recla  = 634 and tpv.referencia_tpv = substr(trim(c.referencia),0,7) and
    tpv.unidad_ejecutora in (select distinct c.unidad_ejecutora
                            from rf_tr_cuentas_bancarias c
                            where c.id_cuenta  in (:idCuentas)) and 
    ue.UNIDAD_EJECUTORA = tpv.UNIDAD_EJECUTORA and 
    ue.entidad = tpv.entidad and 
    ue.ambito = tpv.ambito   
order by 
  ue.unidad_ejecutora, unidad, c.fecha_hora 
</select>
<select id="saldosDiarios">
select 
 descripcion, fecha, saldo_calculado, unidad_ejecutora  
from 
 (select 
   cb.num_cuenta||' '|| decode(cb.id_tipo_cta,6,cb.nombre_cta || ' ' || tc.nombre_corto,cb.nombre_cta) descripcion, sd.fecha, sd.saldo_calculado, cb.unidad_ejecutora
  from
   (select 
     fecha, saldo_calculado, id_cuenta 
    from 
     rf_tr_saldos_diarios 
    where 
     (id_cuenta in (:idCuentas)) and 
     fecha BETWEEN to_date (':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') 
    order by 
     id_cuenta, fecha) sd, rf_tr_cuentas_bancarias cb, RF_TC_TIPO_CUENTA tc 
    where 
     sd.id_cuenta = cb.id_cuenta 
     and cb.id_tipo_cta = tc.id_tipo_cta 
    order by 
    cb.unidad_ejecutora,  cb.num_cuenta, cb.nombre_cta, fecha) 
</select>
<select id="MovimientosCtasTotalDia">
select 
 todasCtas.id_cuenta, todasCtas.num_cuenta, todasCtas.nombre_cta, nvl(totCargo,0) totCargo, nvl(totAbono,0) totAbono , todasCtas.SALDO_CALCULADO, todasCtas.FECHA, todasCtas.UNIDAD_EJECUTORA, todasCtas.SALDO_CALCULADO+nvl(totCargo,0)-nvl(totAbono,0) saldo_inicial  
from 
 (select 
   id_cuenta, num_cuenta, nombre_cta, saldo_final, fecha, unidad_ejecutora, sum(cargo) totCargo, sum(abono) totAbono 
  from
   (select 
     m.id_cuenta,m.num_cuenta, m.nombre_cta,m.id_tipo_trans, m.saldo_calculado saldo_final, (case when m.id_tipo_trans ='DR' then sum(m.monto) end) as cargo, (case when m.id_tipo_trans ='CR' then sum(m.monto) end) as abono, trunc(fecha) fecha, m.unidad_ejecutora 
    from
     (select 
       mc.id_cuenta, cb.num_cuenta, cb.nombre_cta, mc.id_tipo_trans, sd.saldo_calculado, mc.monto, mc.fecha_hora fecha, cb.unidad_ejecutora 
      from 
       RF_TR_MOVIMIENTOS_CUENTA mc, RF_TR_CUENTAS_BANCARIAS cb, RF_TR_SALDOS_DIARIOS sd 
      where 
         cb.id_cuenta = mc.id_cuenta 
         and cb.id_cuenta = sd.id_cuenta and trunc(sd.fecha) = trunc(mc.fecha_hora) and
         (cb.id_cuenta in (:idCuentas)) and 
          mc.fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  mc.fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
      ) m 
      group by
       m.id_cuenta, m.num_cuenta, m.nombre_cta, m.id_tipo_trans, m.saldo_calculado,m.fecha, m.unidad_ejecutora) 
      group by 
       id_cuenta, num_cuenta, nombre_cta, saldo_final, fecha, unidad_ejecutora) movexistentes 
      right join 
       (select 
          cb.ID_CUENTA,NUM_CUENTA,ENTIDAD,ID_BANCO,NOMBRE_CTA,UNIDAD_EJECUTORA,ID_TIPO_CTA,ID_TIPO_PROGRAMA,OPERACION_CENTRAL,ID_ESTATUS_CTA_PROG,AMBITO,PROCESAR,FECHA_OPERACION, ID_SALDO_DIARIO,FECHA,SALDO_CALCULADO 
        from 
          RF_TR_CUENTAS_BANCARIAS cb, RF_TR_SALDOS_DIARIOS sd  
        where 
         cb.id_cuenta = sd.id_cuenta and sd.fecha BETWEEN to_date (':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') 
         and (cb.id_cuenta in (:idCuentas))) todasCtas 
        on 
         movexistentes.id_cuenta = todasCtas.id_cuenta and  movexistentes.fecha = todasCtas.fecha 
        order by 
         todasCtas.UNIDAD_EJECUTORA, todasCtas.num_cuenta, todasCtas.nombre_cta, todasCtas.FECHA 
</select>
<select id="ChqsPagados">
select 
 cb.num_cuenta, cb.nombre_cta, tm.descripcion, tm.fecha_hora, tm.monto, tm.numero_cheque 
from 
 (select 
   id_cuenta, fecha_hora, monto,descripcion, clave_trans_recla,id_clave_trans_recla, id_movimiento, numero_cheque 
  from 
   RF_TR_MOVIMIENTOS_CUENTA 
  where 
   (id_cuenta in (:idCuentas)) and 
   fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
   id_clave_trans_recla  = 22 and monto > 5000.00 
  order by 
   id_cuenta, fecha_hora) tm, RF_TR_CUENTAS_BANCARIAS cb   
where  
   tm.id_cuenta = cb.id_cuenta and cb.id_tipo_cta = 1 and cb.id_estatus_cta_prog = 1  
order by cb.num_cuenta, tm.fecha_hora 
</select>
<select id="ReversoComisiones">
select 
 cb.num_cuenta, cb.nombre_cta, tm.descripcion, to_char(tm.fecha_hora,'dd/mm/yyyy') fecha_hora, tm.clave_trans_recla, tm.monto 
from 
 (select 
   id_cuenta, fecha_hora, monto, descripcion, clave_trans_recla, id_clave_trans_recla, id_movimiento 
  from 
   RF_TR_MOVIMIENTOS_CUENTA 
  where 
   (id_cuenta in (:idCuentas)) and 
   fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora  &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
  order by 
   id_cuenta, fecha_hora) tm,  RF_TC_CLAVES_TRANSACCION tct, RF_TR_CUENTAS_BANCARIAS cb  
where
  tm.id_clave_trans_recla = tct.id_clave_trans and id_tipo_aplica = 'R' and ((tm.fecha_hora >= tct.vigencia_ini and (tm.fecha_hora &lt;= tct.vigencia_fin or tct.vigencia_fin is null))) 
  and tm.id_cuenta = cb.id_cuenta  
order by 
  num_cuenta, fecha_hora 
</select>
<select id="TotalReversoCom">
select 
 cb.num_cuenta, cb.nombre_cta, sum(tm.monto) as TotalComisiones 
from 
 (select 
   id_cuenta, fecha_hora, monto, descripcion, clave_trans_recla, id_clave_trans_recla, id_movimiento 
  from 
   RF_TR_MOVIMIENTOS_CUENTA 
  where 
   (id_cuenta in (:idCuentas)) and 
   fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
  order by 
   id_cuenta, fecha_hora) tm, RF_TC_CLAVES_TRANSACCION tct, RF_TR_CUENTAS_BANCARIAS cb  
where 
  tm.id_clave_trans_recla = tct.id_clave_trans and id_tipo_aplica = 'R' and ((tm.fecha_hora >= tct.vigencia_ini and (tm.fecha_hora &lt;= tct.vigencia_fin or tct.vigencia_fin is null))) 
   and tm.id_cuenta = cb.id_cuenta  
group by 
  cb.num_cuenta, cb.nombre_cta  
</select>
<select id="TotalComisionesCobradas">
select 
 cb.num_cuenta, decode(cb.id_tipo_cta,6,cb.nombre_cta || ' ' || tc.nombre_corto,cb.nombre_cta) nombre_cta , sum(tm.monto) total 
from 
 (select 
   id_cuenta, fecha_hora, monto,descripcion, clave_trans_recla,id_clave_trans_recla, id_movimiento 
  from 
   RF_TR_MOVIMIENTOS_CUENTA 
  where 
   (id_cuenta in (:idCuentas)) and 
   fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
  order by 
   id_cuenta, fecha_hora) tm,  RF_TC_CLAVES_TRANSACCION tct, RF_TC_COSTOS_TRANSACCION tc, RF_TR_CUENTAS_BANCARIAS cb, RF_TC_TIPO_CUENTA tc   
where 
   tm.id_clave_trans_recla = tct.id_clave_trans and id_tipo_aplica = 'C' and ((tm.fecha_hora >= tct.vigencia_ini and (tm.fecha_hora &lt;= tct.vigencia_fin or tct.vigencia_fin is null))) 
   and tct.id_clave_trans = tc.id_clave_trans and ((tm.monto >= tc.limite_inferior and tm.monto &lt;= tc.limite_superior) or (tc.limite_inferior is null and tc.limite_superior is null)) 
   and tm.id_cuenta = cb.id_cuenta 
   and cb.id_tipo_cta = tc.id_tipo_cta 
group by 
  cb.num_cuenta, cb.nombre_cta, cb.id_tipo_cta, tc.nombre_corto  
order by 
  num_cuenta 
</select>
<select id="TransaccionalidadCuentas">
select 
 transacciones, descripcion, substr(fecha,9,2)||'/'|| substr(fecha,6,2)||'/'|| substr(fecha,1,4) fecha 
from 
 (select 
    count(mc.id_cuenta) as transacciones, cb.num_cuenta ||' ' || (decode(cb.id_tipo_cta,6,cb.nombre_cta || ' ' || tc.nombre_corto,cb.nombre_cta)) descripcion, decode(mc.fecha_hora,null,':fechaInicial',mc.fecha_hora) as fecha 
  from 
    (select 
      id_cuenta, to_char(fecha_hora,'yyyy-mm-dd') fecha_hora 
     from 
      rf_tr_movimientos_cuenta 
     where 
      (id_cuenta in (:idCuentas)) and 
      fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1
     order by
      id_cuenta ) mc 
     RIGHT JOIN 
      (select 
        cb.ID_CUENTA,NUM_CUENTA,ENTIDAD,ID_BANCO,NOMBRE_CTA,UNIDAD_EJECUTORA,ID_TIPO_CTA,ID_TIPO_PROGRAMA,OPERACION_CENTRAL,ID_ESTATUS_CTA_PROG,AMBITO,PROCESAR,FECHA_OPERACION 
       from 
        RF_TR_CUENTAS_BANCARIAS cb 
       where 
        (cb.id_cuenta in (:idCuentas)) ) cb 
       on 
        mc.id_cuenta = cb.id_cuenta 
       inner join 
        RF_TC_TIPO_CUENTA tc 
       on 
        cb.id_tipo_cta = tc.id_tipo_cta  
       group by 
        mc.id_cuenta, cb.num_cuenta, cb.nombre_cta, mc.fecha_hora,cb.id_tipo_cta, tc.nombre_corto 
       order by 
        cb.num_cuenta, mc.fecha_hora)  
</select>
<select id="DetalleComisionesCobradas">
select 
 cb.num_cuenta, decode(cb.id_tipo_cta,6,cb.nombre_cta || ' ' || tc.nombre_corto,cb.nombre_cta) nombre_cta,tm.descripcion, tm.fecha_hora fecha_hora, tm.clave_trans_recla, tm.monto  
from 
 (select 
    id_cuenta, fecha_hora, monto, descripcion, clave_trans_recla, id_clave_trans_recla, id_movimiento 
  from 
   RF_TR_MOVIMIENTOS_CUENTA 
  where 
   (id_cuenta in (:idCuentas)) and 
   fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
  order by 
   id_cuenta, fecha_hora) tm, RF_TC_CLAVES_TRANSACCION tct,   RF_TC_COSTOS_TRANSACCION tc,  RF_TR_CUENTAS_BANCARIAS cb,  RF_TC_TIPO_CUENTA tc  
where  
 tm.id_clave_trans_recla = tct.id_clave_trans and id_tipo_aplica = 'C' and ((tm.fecha_hora >= tct.vigencia_ini and (tm.fecha_hora &lt;= tct.vigencia_fin or tct.vigencia_fin is null))) 
 and tct.id_clave_trans = tc.id_clave_trans and ((tm.monto >= tc.limite_inferior and tm.monto &lt;= tc.limite_superior) or (tc.limite_inferior is null and tc.limite_superior is null)) 
 and tm.id_cuenta = cb.id_cuenta 
 and cb.id_tipo_cta = tc.id_tipo_cta  
order by 
 num_cuenta, fecha_hora 
</select>
<select id="MovimientosCuentasPropias">
select 
 num_cuenta, nombre_cta, to_date(fecha, 'yyyy-MM-dd') fecha, cargo, abono 
from 
 (select 
   (case when t.fecha is null then f.num_cuenta else t.num_cuenta end) num_cuenta, (case when t.fecha is null then f.nombre_cta else t.nombre_cta end) nombre_cta, (case when t.fecha is null then f.fecha else t.fecha end) fecha, nvl(cargo, 0) as cargo, nvl(abono,0) as abono 
 from 
  (select 
    num_cuenta, nombre_cta, fecha, nvl(cargo, 0) as cargo, nvl(abono,0) as abono, unidad_ejecutora 
   from 
     (select 
        m.num_cuenta, m.nombre_cta, m.fecha, m.id_tipo_trans, (case when m.id_tipo_trans ='CR' then sum(m.monto) end) as cargo, (case when m.id_tipo_trans ='DR' then sum(m.monto) end) as abono , unidad_ejecutora 
      from 
        (select 
          cb.num_cuenta, cb.nombre_cta, nvl(mc.monto,0) monto, nvl(mc.id_tipo_trans,0) id_tipo_trans, nvl(mc.descripcion,' ') descripcion, mc.fecha_hora fecha, unidad_ejecutora 
         from 
          (select 
             id_cuenta, num_cuenta, nombre_cta, unidad_ejecutora 
           from 
            RF_TR_CUENTAS_BANCARIAS 
           where 
            id_cuenta in (:idCuentas)) cb 
           left join 
             (select 
                mov.id_cuenta, monto, id_tipo_trans, descripcion, fecha_hora 
              from 
                (select 
                   id_cuenta, monto, id_tipo_trans, descripcion, to_char(trunc(fecha_hora),'yyyy-MM-dd') fecha_hora, substr(trim(descripcion),-10,10) cuenta 
                 from 
                  RF_TR_MOVIMIENTOS_CUENTA 
                 where 
                  (id_cuenta in (:idCuentas)) and 
                  fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
                  and clave_trans in (5423, 5489)) mov 
                 inner join 
                  (select 
                    ID_CUENTA,NUM_CUENTA,ENTIDAD,ID_BANCO,NOMBRE_CTA,UNIDAD_EJECUTORA,ID_TIPO_CTA,ID_TIPO_PROGRAMA,OPERACION_CENTRAL,ID_ESTATUS_CTA_PROG, AMBITO,PROCESAR,FECHA_OPERACION,FECHA_FIN_OPERACION 
                   from 
                    RF_TR_CUENTAS_BANCARIAS 
                   where 
                    id_tipo_programa = (select 
                                         distinct id_tipo_programa 
                                        from 
                                         RF_TR_CUENTAS_BANCARIAS 
                                        where 
                                         id_cuenta in (:idCuentas))) ctas 
                  on 
                   ctas.num_cuenta = mov.cuenta ) mc 
                  on 
                   cb.id_cuenta = mc.id_cuenta ) m 
                  group by 
                   m.num_cuenta, m.nombre_cta, m.fecha, m.id_tipo_trans, m.unidad_ejecutora 
                  order by 
                   m.fecha, m.num_cuenta)) t, (select 
                                                * 
                                               from 
                                                 (select 
                                                    rownum-1, to_char(to_date(':fechaInicial','yyyy-mm-dd')+ rownum-1,'yyyy-mm-dd') fecha 
                                                  from 
                                                   rf_tr_saldos_diarios t 
                                                  where 
                                                   to_date(':fechaInicial','yyyy-mm-dd')+ rownum-1 BETWEEN to_date (':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) tt, 
                                              (select 
                                                c.num_cuenta, c.nombre_cta, c.unidad_ejecutora 
                                               from 
                                                rf_tr_cuentas_bancarias c 
                                               where 
                                                c.id_cuenta in (:idCuentas)) cc ) f 
                                               where 
                                                t.num_cuenta(+) = f.num_cuenta and t.fecha(+) = f.fecha 
                                               order by 
                                                f.unidad_ejecutora,  num_cuenta, nombre_cta, fecha) 
</select>
<select id="ReferenciasIdentificadasReintegros">
select 
 res.fecha_hora, res.num_cuenta, res.nombre_cta, res.referencia, res.monto, res.descripcion, res.ctaAfecta, cbl.nombre_cta ctaAfectar  
from 
  (SELECT 
     mc.fecha_hora, cb.num_cuenta, cb.nombre_cta, mc.referencia, mc.monto, mc.descripcion, substr(trim(mc.descripcion),-10,10) ctaAfecta 
   FROM 
     (SELECT 
         id_cuenta, monto, referencia, fecha_hora, clave_trans_recla, descripcion, id_tipo_trans 
      FROM 
        rf_tr_movimientos_cuenta 
      WHERE 
        (id_cuenta in (:idCuentas)) AND
        fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
        id_tipo_trans = 'CR' AND 
        (id_clave_trans_recla = 5 OR id_clave_trans_recla = 27) AND (clave_trans_recla = 5423 OR clave_trans_recla = 5489) AND 
        (referencia LIKE '%ARE%' OR (SUBSTR(referencia,    1,    2) = '03' OR SUBSTR(referencia,    1,    2) = '04' OR SUBSTR(referencia,    1,    2) = '23' OR 
         SUBSTR(referencia,    1,    2) = '24')) 
      ORDER BY 
        id_cuenta) mc 
      INNER JOIN 
       rf_tr_cuentas_bancarias cb 
      ON 
       mc.id_cuenta = cb.id_cuenta and num_cuenta not in ('4042547851','4042547869') and cb.id_tipo_cta not in (5,1,2)) res 
      inner join 
       rf_tr_cuentas_bancarias cbl 
      on 
       res.ctaAfecta = cbl.num_cuenta and cbl.id_tipo_cta !=3 
      order by 
       res.num_cuenta,  fecha_hora, ctaAfecta
</select>
<select id="comisionesTPV">
select m.fecha_hora, m.unidad, m.unidad_ejecutora,m.monto, com.credito, com.debito from  
(select fecha_hora, unidad, unidad_ejecutora,
      sum(decode(valor,1,abs(monto)/0.018,0)) credito,
      sum(decode(valor,2,abs(monto)/0.013,0)) debito     
from (
    select 
        fecha_hora, c.monto, substr(trim(c.referencia),0,7) || ' - ' || ue.descripcion || '  ' || tpv.descripcion unidad,
        ue.unidad_ejecutora,
        case when c.referencia like '%COMISION TAR CRED%' then 1
             when c.referencia like '%COMISION TAR DEBIT%' then 2
        end valor 
    from 
        rf_tr_movimientos_cuenta c , rf_tc_cuentas_tpv tpv, rf_tc_unidades_ejecutoras_tece ue 
    where 
        fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
        id_clave_trans_recla  =324  and tpv.referencia_tpv = substr(trim(c.referencia),0,7) and
        tpv.unidad_ejecutora in (select distinct c.unidad_ejecutora
                                from rf_tr_cuentas_bancarias c
                                where c.id_cuenta  in (:idCuentas)) and 
        ue.UNIDAD_EJECUTORA = tpv.UNIDAD_EJECUTORA and 
        ue.entidad = tpv.entidad and 
        ue.ambito = tpv.ambito 
    )
 group by fecha_hora, unidad, unidad_ejecutora) com, 
    (select 
        fecha_hora, sum(c.monto) monto, substr(trim(c.referencia),0,7) || ' - ' || ue.descripcion || '  ' || tpv.descripcion unidad,
        ue.unidad_ejecutora
    from 
        rf_tr_movimientos_cuenta c , rf_tc_cuentas_tpv tpv, rf_tc_unidades_ejecutoras_tece ue 
    where 
        fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 and
        id_clave_trans_recla  = 634  and tpv.referencia_tpv = substr(trim(c.referencia),0,7) and
        tpv.unidad_ejecutora in (select distinct c.unidad_ejecutora
                                from rf_tr_cuentas_bancarias c
                                where c.id_cuenta  in (:idCuentas)) and 
        ue.UNIDAD_EJECUTORA = tpv.UNIDAD_EJECUTORA and 
        ue.entidad = tpv.entidad and 
        ue.ambito = tpv.ambito 
         group by fecha_hora,ue.unidad_ejecutora ,  substr(trim(c.referencia),0,7) || ' - ' || ue.descripcion || '  ' || tpv.descripcion
        ) m   
where com.FECHA_HORA = m.fecha_hora and
      com.unidad = m.unidad and
      com.unidad_ejecutora = m.unidad_ejecutora   
order by m.unidad, m.unidad_ejecutora,m.fecha_hora 
</select>
<select id="consolidacionSaldosNL">
select 
 unidad, nombre_corto, 
 sum(decode(bandera,1,saldo,0)) saldoActual, 
 sum(decode(bandera,0,saldo,0)) saldoAnterior 
from  
( 
select 
   sum(saldo_calculado) saldo, unidad,
   decode(unidad,102,'Contraloría Interna',
                               105,'D.G. Estadísticas Sociodemográficas',106,'D.G. Estadísticas Económicas',
                               107,'D.G. Geografía y Medio Ambiente',108,'D.G. Servicio Público de Información',
                               109,'D.G. de Administración', 096,'Concentradoras',
                               097,'Gasto Corriente',098,'Servicios Personales',
                               099,'Ingresos', 100,'Reintegros',nombre_corto) nombre_corto, 1 bandera 
from  
(select 
      saldo_calculado,fecha, 
      decode(num_cuenta,'08400029084','098','08400030457','098','4042547752','096','43710149845','096','08400029068','096',         
                        '0161763024','096','18000008500','096','08400029076','097','8788788','096','00003357627','096',
                           '08400031046','096',
                        '08400029122','099','08400029386','099','43710154369','099','08400029106','100', cb.unidad_ejecutora ) unidad, 
      decode(num_cuenta,'43710154369','D.G. Administración',nombre_corto)nombre_corto 
from 
      rf_tr_saldos_diarios sd, rf_tr_cuentas_bancarias cb, 
      RH_TC_UNI_EJECUTORAS ue   
where 
      fecha =  to_date(':fechaFinal','yyyy-mm-dd') and
      cb.unidad_ejecutora = ue.unidad_ejecutora and 
      sd.id_cuenta = cb.id_cuenta and (cb.id_cuenta in (:idCuentas)) and
      (trunc(cb.FECHA_FIN_OPERACION) >= to_date(':fechaInicial','yyyy-mm-dd') or cb.FECHA_FIN_OPERACION is null)  and 
      ((vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
       (vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
       (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
       (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR vigencia_hasta IS NULL))) 
)sub 
group by unidad, nombre_corto 
union all 
select 
   sum(saldo_calculado) saldo, unidad,
   decode(unidad,102,'Contraloría Interna',
                               105,'D.G. Estadísticas Sociodemográficas',106,'D.G. Estadísticas Económicas',
                               107,'D.G. Geografía y Medio Ambiente',108,'D.G. Servicio Público de Información',
                               109,'D.G. de Administración', 096,'Concentradoras',
                               097,'Gasto Corriente',098,'Servicios Personales',
                               099,'Ingresos', 100,'Reintegros',nombre_corto) nombre_corto, 0 bandera   
from  
(select 
      saldo_calculado,fecha, 
      decode(num_cuenta,'08400029084','098','08400030457','098','4042547752','096','43710149845','096','08400029068','096',         
                        '0161763024','096','18000008500','096','08400029076','097','8788788','096','00003357627','096',
                           '08400031046','096',
                        '08400029122','099','08400029386','099','43710154369','099','08400029106','100', cb.unidad_ejecutora ) unidad, 
      decode(num_cuenta,'43710154369','D.G. Administración',nombre_corto)nombre_corto   
from 
      rf_tr_saldos_diarios sd, rf_tr_cuentas_bancarias cb, 
      RH_TC_UNI_EJECUTORAS ue   
where 
      fecha =  to_date(':fechaInicial','yyyy-mm-dd') and
      cb.unidad_ejecutora = ue.unidad_ejecutora and 
      sd.id_cuenta = cb.id_cuenta and (cb.id_cuenta in (:idCuentas)) and
      (trunc(cb.FECHA_FIN_OPERACION) >= to_date(':fechaInicial','yyyy-mm-dd') or cb.FECHA_FIN_OPERACION is null) and 
      ((vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
       (vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
       (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
       (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR vigencia_hasta IS NULL)))
 )sub 
group by unidad, nombre_corto 
) 
group by  
      unidad, nombre_corto 
order by unidad 
</select>
<select id="consolidacionSaldosBMX">
select 
 unidad_ejecutora ue, nombre_corto unidad, 
 sum(decode(tipoCuenta||bandera,10,saldo,0)) ingSAL_ANT, 
 sum(decode(tipoCuenta||bandera,11,saldo,0)) ingSAL_ACT, 
 sum(decode(tipoCuenta||bandera,20,saldo,0)) cgcSAL_ANT, 
 sum(decode(tipoCuenta||bandera,21,saldo,0)) cgcSAL_ACT, 
 sum(decode(tipoCuenta||bandera,30,saldo,0)) cspSAL_ANT, 
 sum(decode(tipoCuenta||bandera,31,saldo,0)) cspSAL_ACT         
from 
 (select 
    sum(saldo_calculado) saldo, res.tipoCuenta, 
    decode(res.unidad_ejecutora,'901','0901','902','0902',res.unidad_ejecutora) unidad_ejecutora, 
    res.nombre_corto,0 bandera 
  from 
    (select 
       saldo_calculado, unidad_ejecutora,
       decode(sub.unidad_ejecutora,901,'Tesorería',902,'Contabilidad Institucional',102,'Contraloría Interna',
                                   105,'D.G. Estadísticas Sociodemográficas',106,'D.G. Estadísticas Económicas',
                                   107,'D.G. Geografía y Medio Ambiente',108,'D.G. Servicio Público de Información',
                                   109,'D.G. de Administración',sub.nombre_corto) nombre_corto,
       decode(tipo_cuenta,6,1,1,2,2,3,tipo_cuenta) tipoCuenta 
     from 
       (select 
         saldo_calculado,fecha, 
         decode(num_cuenta,'08400029068',6,'43710149845',1,'08400029076',1,'08400029084',2,         
                           '08400029106',1,'08400029114',1,cb.id_tipo_cta  ) tipo_cuenta,
         cb.id_tipo_cta,
         decode(num_cuenta,'08400029068','901','43710149845','901','08400029076','901','08400029084','901','08400029092','901',         
                           '08400029122','901','08400029106','901','08400029114','901',
                           '08400030457','901','08400029386','901', cb.unidad_ejecutora ) unidad_ejecutora, 
         nombre_corto 
        from 
         rf_tr_saldos_diarios sd,rf_tr_cuentas_bancarias cb, 
         RH_TC_UNI_EJECUTORAS ue   
          where 
         fecha =  to_date(':fechaInicial','yyyy-mm-dd') and
         cb.unidad_ejecutora = ue.unidad_ejecutora and
          sd.id_cuenta = cb.id_cuenta and (cb.id_cuenta in (:idCuentas)) and
         ((vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
          (vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
          (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
          (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR vigencia_hasta IS NULL)))
       
          )sub) res 
        group by 
         tipoCuenta, unidad_ejecutora, nombre_corto 
        union all 
        select 
          sum(saldo_calculado) saldo, res.tipoCuenta, 
             decode(res.unidad_ejecutora,'901','0901','902','0902',res.unidad_ejecutora) unidad_ejecutora, 
          res.nombre_corto, 1 bandera 
        from 
          (select 
             saldo_calculado, unidad_ejecutora,num_cuenta,
             decode(sub.unidad_ejecutora,901,'Tesorería',902,'Contabilidad Institucional',102,'Contraloría Interna',
                                   105,'D.G. Estadísticas Sociodemográficas',106,'D.G. Estadísticas Económicas',
                                   107,'D.G. Geografía y Medio Ambiente',108,'D.G. Servicio Público de Información',
                                   109,'D.G. de Administración',sub.nombre_corto) nombre_corto,
            decode(tipo_cuenta,6,1,1,2,2,3,tipo_cuenta) tipoCuenta 
          from 
            (select 
         saldo_calculado,fecha, num_cuenta,
         decode(num_cuenta,'08400029068',6,'43710149845',1,'08400029076',1,'08400029084',2,         
                           '08400029106',1,'08400029114',1,cb.id_tipo_cta  ) tipo_cuenta,
         cb.id_tipo_cta,
         decode(num_cuenta,'08400029068','901','43710149845','901','08400029076','901','08400029084','901','08400029092','901',         
                           '08400029122','901','08400029106','901','08400029114','901',
                           '08400030457','901','08400029386','901', cb.unidad_ejecutora ) unidad_ejecutora, 
         nombre_corto 
        from 
         rf_tr_saldos_diarios sd,rf_tr_cuentas_bancarias cb, 
         RH_TC_UNI_EJECUTORAS ue   
          where 
            fecha =  to_date(':fechaFinal','yyyy-mm-dd') and
            cb.unidad_ejecutora = ue.unidad_ejecutora and
            sd.id_cuenta = cb.id_cuenta and (cb.id_cuenta in (:idCuentas)) and
              ((vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
               (vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
               (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
               (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR vigencia_hasta IS NULL)))
              )sub) res 
             group by 
              tipoCuenta, unidad_ejecutora, nombre_corto 
            order by 
              unidad_ejecutora, tipoCuenta) 
          
            group by 
             unidad_ejecutora, nombre_corto
            order by 
             unidad_ejecutora
</select>
<select id="consolidacionSaldos">
select 
 unidad_ejecutora, nombre_corto, sum(decode(tipoCuenta||bandera,10,saldo,0)) dispAnt, sum(decode(tipoCuenta||bandera,11,saldo,0)) dispAct, sum(decode(tipoCuenta||bandera,20,saldo,0)) ingAnt, sum(decode(tipoCuenta||bandera,21,saldo,0)) ingpAct, sum(decode(tipoCuenta||bandera,30,saldo,0)) chqGCAnt, sum(decode(tipoCuenta||bandera,31,saldo,0)) chqGCAct,       sum(decode(tipoCuenta||bandera,40,saldo,0)) chqSPAnt, sum(decode(tipoCuenta||bandera,41,saldo,0)) chqSPAct  
from 
 (select 
    sum(saldo_calculado) saldo, res.tipoCuenta, res.unidad_ejecutora, res.nombre_corto,0 bandera 
  from 
    (select 
       saldo_calculado, unidad_ejecutora, nombre_corto, decode(tipo_cuenta,3,1,4,1,5,1,6,2,1,3,2,4,tipo_cuenta) tipoCuenta 
     from 
       (select 
         saldo_calculado,fecha, decode(num_cuenta,'4042547885',6,'4042547869',6,cb.id_tipo_cta ) tipo_cuenta, 
         decode(num_cuenta,'4042547752','100','4040444184','100','4024426090','100','4039477765','100',cb.unidad_ejecutora ) unidad_ejecutora, 
         decode(num_cuenta,'4042547752','Tesorería','4040444184','Tesorería','4024426090','Tesorería','4039477765','Tesorería',ue.nombre_corto ) nombre_corto 
        from 
         rf_tr_saldos_diarios sd 
        inner join 
         rf_tr_cuentas_bancarias cb 
        on 
         sd.id_cuenta = cb.id_cuenta and (cb.id_cuenta in (:idCuentas))    
        inner join 
          RH_TC_UNI_EJECUTORAS ue    
        on 
         cb.unidad_ejecutora = ue.unidad_ejecutora and
         ((vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
          (vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
          (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
          (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR vigencia_hasta IS NULL)))
        where 
         fecha =  to_date(':fechaInicial','yyyy-mm-dd') and
              num_cuenta != 4042680082
          )sub) res 
        group by 
         tipoCuenta, unidad_ejecutora, nombre_corto 
        union all 
        select 
          sum(saldo_calculado) saldo, res.tipoCuenta, res.unidad_ejecutora, res.nombre_corto, 1 bandera 
        from 
          (select 
             saldo_calculado, unidad_ejecutora, nombre_corto, decode(tipo_cuenta,3,1,4,1,5,1,6,2,1,3,2,4,tipo_cuenta) tipoCuenta 
          from 
            (select 
               saldo_calculado, decode(num_cuenta,'4042547885',6,'4042547869',6,cb.id_tipo_cta ) tipo_cuenta, 
               decode(num_cuenta,'4042547752','100','4040444184','100','4024426090','100','4039477765','100',cb.unidad_ejecutora ) unidad_ejecutora, 
               decode(num_cuenta,'4042547752','Tesorería','4040444184','Tesorería','4024426090','Tesorería','4039477765','Tesorería',ue.nombre_corto ) nombre_corto 
             from 
               rf_tr_saldos_diarios sd 
             inner join 
               rf_tr_cuentas_bancarias cb    
             on 
              sd.id_cuenta = cb.id_cuenta and (cb.id_cuenta in (:idCuentas)) 
             inner join 
              RH_TC_UNI_EJECUTORAS ue    
             on 
              cb.unidad_ejecutora = ue.unidad_ejecutora   and
              ((vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
               (vigencia_desde &lt;= to_date(':fechaInicial','yyyy-mm-dd')  AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
               (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta >= to_date(':fechaFinal','yyyy-mm-dd')) OR vigencia_hasta IS NULL) OR 
               (vigencia_desde BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') AND (vigencia_hasta BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') OR vigencia_hasta IS NULL)))
             where 
              fecha = to_date(':fechaFinal','yyyy-mm-dd') and
              num_cuenta != 4042680082
              )sub) res 
             group by 
              tipoCuenta, unidad_ejecutora, nombre_corto 
            order by 
              unidad_ejecutora, tipoCuenta) 
            group by 
             unidad_ejecutora, nombre_corto 
</select>
<select id="MovimientosCtasDetalleBMX">
select cb.id_cuenta, cb.num_cuenta, cb.nombre_cta, fecha_hora,  
       decode(clave_trans_recla,null,' ',clave_trans_recla) || ' ' || decode(descripcion,null,' ',descripcion) descripcion,
       nvl(decode(id_tipo_trans,'D',monto,0),0) cargo, nvl(decode(id_tipo_trans,'C',monto,0),0) abono, nvl(saldo,0) saldo,
       decode(referencia,null,' ',referencia) referencia, nvl(saldo_inicial,0) saldo_inicial,  nvl(saldo_final,0) saldo_final    
from  
    RF_TR_CUENTAS_BANCARIAS cb, RF_TR_MOVIMIENTOS_CUENTA m,
    (select 
         m2.id_cuenta,  nvl(sd.saldo_calculado,0) saldo_inicial, 
         nvl(sd.saldo_calculado,0)+sum(decode(m2.id_tipo_trans,'C',monto,0)) +sum(decode(m2.id_tipo_trans,'D',monto,0)) saldo_final
     from 
         RF_TR_MOVIMIENTOS_CUENTA m2, 
         (select id_cuenta, saldo_calculado from rf_tr_saldos_diarios 
          where id_cuenta in (:idCuentas) and  
                fecha = (select  tsr.obten_anterior_dia_habil(to_date (':fechaInicial','yyyy-mm-dd')) from dual)
          )sd
     where 
          m2.id_cuenta in (:idCuentas) and 
          m2.fecha_hora >= to_date(':fechaInicial','yyyy-mm-dd') AND  m2.fecha_hora &lt; to_date(':fechaFinal','yyyy-mm-dd')+1 and 
          m2.id_cuenta = sd.id_cuenta(+) 
     group by m2.id_cuenta,saldo_calculado) sal    
where cb.id_cuenta in (:idCuentas) and cb.id_cuenta = m.id_cuenta(+) and cb.id_cuenta = sal.id_cuenta(+)  and
      m.fecha_hora >= to_date(':fechaInicial','yyyy-mm-dd') AND  m.fecha_hora &lt; to_date(':fechaFinal','yyyy-mm-dd')+1   
order by cb.num_cuenta, fecha_hora,  id_movimiento
</select>
<select id="MovimientosCtasDetalleBBVA">
select cb.id_cuenta, cb.num_cuenta, cb.nombre_cta, fecha_hora,  nvl(numero_cheque,0) numero_cheque, 
       decode(clave_trans_recla,null,' ',clave_trans_recla) || ' ' || decode(descripcion,null,' ',descripcion) descripcion,
       nvl(decode(id_tipo_trans,'DR',monto,0),0) cargo, nvl(decode(id_tipo_trans,'CR',monto,0),0) abono, nvl(saldo,0) saldo,
       nvl(numero_folio,0) numero_folio,
       decode(referencia,null,' ',referencia) referencia, nvl(saldo_inicial,0) saldo_inicial,  nvl(saldo_final,0) saldo_final   
from 
    RF_TR_CUENTAS_BANCARIAS cb, RF_TR_MOVIMIENTOS_CUENTA m,
    (select 
         m2.id_cuenta,  nvl(sd.saldo_calculado,0) saldo_inicial, 
         nvl(sd.saldo_calculado,0)+sum(decode(m2.id_tipo_trans,'CR',monto,0)) +sum(decode(m2.id_tipo_trans,'DR',monto,0)) saldo_final
     from 
         RF_TR_MOVIMIENTOS_CUENTA m2, 
         (select id_cuenta, saldo_calculado from rf_tr_saldos_diarios 
          where id_cuenta in (:idCuentas) and  
                fecha = (select  tsr.obten_anterior_dia_habil(to_date (':fechaInicial','yyyy-mm-dd')) from dual)
          )sd
     where 
          m2.id_cuenta in (:idCuentas) and 
          m2.fecha_hora >= to_date(':fechaInicial','yyyy-mm-dd') AND  m2.fecha_hora &lt; to_date(':fechaFinal','yyyy-mm-dd')+1 and 
          m2.id_cuenta = sd.id_cuenta(+) 
     group by m2.id_cuenta,saldo_calculado) sal   
where cb.id_cuenta in (:idCuentas) and cb.id_cuenta = m.id_cuenta(+) and cb.id_cuenta = sal.id_cuenta(+)  and
      m.fecha_hora >= to_date(':fechaInicial','yyyy-mm-dd') AND  m.fecha_hora &lt; to_date(':fechaFinal','yyyy-mm-dd')+1   
order by cb.num_cuenta, fecha_hora,  id_movimiento
</select>
<select id="MovimientosCtasDetalle">
select cb.id_cuenta, cb.num_cuenta, cb.nombre_cta, fecha_hora,  nvl(numero_cheque,0) numero_cheque, 
       decode(clave_trans_recla,null,' ',clave_trans_recla) || ' ' || decode(descripcion,null,' ',descripcion) descripcion,
       nvl(decode(id_tipo_trans,'DR',monto,0),0) cargo, nvl(decode(id_tipo_trans,'CR',monto,0),0) abono, nvl(saldo,0) saldo,
       nvl(numero_folio,0) numero_folio,
       decode(referencia,null,' ',referencia) referencia, nvl(saldo_inicial,0) saldo_inicial,  nvl(saldo_final,0) saldo_final    
from 
    RF_TR_CUENTAS_BANCARIAS cb, RF_TR_MOVIMIENTOS_CUENTA m,
    (select 
         m2.id_cuenta,  nvl(sd.saldo_calculado,0) saldo_inicial, 
         nvl(sd.saldo_calculado,0)+sum(decode(m2.id_tipo_trans,'CR',monto,0)) -sum(decode(m2.id_tipo_trans,'DR',monto,0)) saldo_final
     from 
         RF_TR_MOVIMIENTOS_CUENTA m2, 
         (select id_cuenta, saldo_calculado from rf_tr_saldos_diarios 
          where id_cuenta in (:idCuentas) and  
                fecha = (select  tsr.obten_anterior_dia_habil(to_date (':fechaInicial','yyyy-mm-dd')) from dual)
          )sd
     where 
          m2.id_cuenta in (:idCuentas) and 
          m2.fecha_hora >= to_date(':fechaInicial','yyyy-mm-dd') AND  m2.fecha_hora &lt; to_date(':fechaFinal','yyyy-mm-dd')+1 and 
          m2.id_cuenta = sd.id_cuenta(+) 
     group by m2.id_cuenta,saldo_calculado) sal   
where cb.id_cuenta in (:idCuentas) and cb.id_cuenta = m.id_cuenta(+) and cb.id_cuenta = sal.id_cuenta(+)  and
      m.fecha_hora >= to_date(':fechaInicial','yyyy-mm-dd') AND  m.fecha_hora &lt; to_date(':fechaFinal','yyyy-mm-dd')+1    
order by cb.num_cuenta, fecha_hora,  id_movimiento
</select>
<select id="RendimientosTodosProgramas">
select 
 nombre_cta, num_cuenta, rendimientos, ue.descripcion, r.unidad_ejecutora, r.entidad, r.ambito, grupo , unidad, subtotal  
from 
 (select 
   cb.nombre_cta, cb.num_cuenta, nvl(mc.rendimientos,0) rendimientos,  cb.unidad_ejecutora, cb.entidad, cb.ambito, CASE cb.unidad_ejecutora WHEN '102' THEN '101' WHEN '109' THEN case when cb.entidad = 9 then '101' when cb.num_cuenta = '4042105304' then '101' when cb.num_cuenta = '4042105312' then '101' when cb.num_cuenta = '4042105338' then '107' when cb.num_cuenta = '4042105346' then '105' when cb.num_cuenta = '4042105353' then '108' when cb.num_cuenta = '4042105361' then '113' when cb.num_cuenta = '4042105379' then '106' else cb.unidad_ejecutora end when '108' then case when cb.num_cuenta = '4042986018' then '109' when cb.num_cuenta = '4024114555' then '109' else cb.unidad_ejecutora end  ELSE cb.unidad_ejecutora END || decode(cb.entidad || cb.ambito,    '91',    '1',    cb.entidad) || cb.ambito grupo, CASE cb.unidad_ejecutora  WHEN '102' THEN '101' WHEN '109' THEN case when cb.entidad = 9 then '101' when cb.num_cuenta = '4042105304' then '101' when cb.num_cuenta = '4042105312' then '101' when cb.num_cuenta = '4042105338' then '107' when cb.num_cuenta = '4042105346' then '105' when cb.num_cuenta = '4042105353' then '108' when cb.num_cuenta = '4042105361' then '113' when cb.num_cuenta = '4042105379' then '106' else cb.unidad_ejecutora end when '108' then case when cb.num_cuenta = '4042986018' then '109' when cb.num_cuenta = '4024114555' then '109' else cb.unidad_ejecutora end ELSE cb.unidad_ejecutora END unidad, case when cb.unidad_ejecutora &lt; '121' then 0 when cb.unidad_ejecutora = '130' then 0 else 1 end subtotal 
   from 
   (select 
     nombre_cta, num_cuenta, id_cuenta, case unidad_ejecutora when '100' then '109' else unidad_ejecutora end unidad_ejecutora, entidad, ambito, id_tipo_programa 
    from 
     rf_tr_cuentas_bancarias 
    where 
     id_tipo_programa != (select 
                           decode(programa,6,1,6) res 
                          from 
                           (select distinct(id_tipo_programa) programa 
                            from 
                             RF_TR_CUENTAS_BANCARIAS 
                            where 
                             (id_cuenta in (:idCuentas)))) and ((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd')) or 
                                                          fecha_fin_operacion is null ) or (fecha_operacion  &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
                                                          fecha_fin_operacion is null ) ) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
                                                          fecha_fin_operacion is null)) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') or fecha_fin_operacion is null)))
                              and id_tipo_cta !=8 and id_tipo_programa in (6,1) 
                              ) cb
                          left join
                           (select 
                             id_cuenta,  SUM(monto) AS rendimientos 
                            from 
                             rf_tr_movimientos_cuenta 
                            where
                             fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
                             AND (id_clave_trans_recla = 47 OR id_clave_trans_recla = 69 OR id_clave_trans_recla = 177) AND descripcion LIKE '%INT%' 
                            group by 
                             id_cuenta) mc 
                          on 
                           cb.id_cuenta = mc.id_cuenta ) r
                          INNER JOIN 
                           rf_tc_unidades_ejecutoras_tece ue 
                          ON 
                           r.unidad = ue.unidad_ejecutora AND (r.entidad = ue.entidad)  AND r.ambito = ue.ambito 
                          ORDER BY 
                           grupo, num_cuenta 
</select>
<select id="RendimientosTodosProgramasBMX">
select 
 nombre_cta, num_cuenta, rendimientos, decode(ue.descripcion,'Oficina del C. Presidente','Junta de Gobierno y Presidencia','Organo Interno de Control','Contraloria Interna',ue.descripcion) descripcion, r.unidad_ejecutora, r.entidad, r.ambito,  unidad, 
 decode (r.unidad,'901','0901','902','0902',r.unidad) || decode(r.entidad || r.ambito,    '91',    '1',    r.entidad) || r.ambito grupo,
 case when unidad &lt; '121' then 0 
      when unidad in ('130','901','902') then 0 else 1 end subtotal  
from 
 (select 
   cb.nombre_cta, cb.num_cuenta, nvl(mc.rendimientos,0) rendimientos,  cb.unidad_ejecutora,  
   decode(cb.ambito, '08400029068',1,'43710149845',1,'08400029076',1,'08400029084',1,'08400029092',1,'08400030457',1,
                     '43710154377',1,'43710155101',1,'43710155098',1,'43710155071',1,'43710155063',1,'43710154857',1,'43710154741',1,
                     '43710154725',1,'43710154547',1,'43710154431',1,'08400029386',1,
                     '08400029106',1,'08400029114',1,'08400029122',1,'43710154369',1,cb.ambito) ambito,
   decode(num_cuenta,'43710154377',1,'43710155101',1,'43710155098',1,'43710155071',1,'43710155063',1,'43710154857',1,'43710154741',1,
                     '43710154725',1,'43710154547',1,'43710154431',1,'08400029386',1,
                     '08400029068',1,'43710149845',1,'08400029076',1,'08400029084',1,'08400029092',1,'08400030457',1,
                     '08400029106',1,'08400029114',1,'08400029122',1,'43710154369',1,cb.entidad) entidad,
   CASE cb.unidad_ejecutora  
                             when '108' then case when cb.num_cuenta = '43710154369' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '109' then case when cb.num_cuenta in ('08400029068','43710149845','08400029076','08400029084','08400029092','08400030457') then '901'
                                                  when cb.num_cuenta in ('08400029122','08400029114','08400029106','08400029386')  then '902' 
                                                                     else  cb.unidad_ejecutora end 
                             when '121' then case when cb.num_cuenta = '43710154377' then '902'
                                                                    else cb.unidad_ejecutora end 
                             when '122' then case when cb.num_cuenta = '43710154431' then '902'
                                                                    else cb.unidad_ejecutora end                                   
                             when '123' then case when cb.num_cuenta = '43710154547' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '124' then case when cb.num_cuenta = '43710154725' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '125' then case when cb.num_cuenta = '43710154741' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '126' then case when cb.num_cuenta = '43710154857' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '127' then case when cb.num_cuenta = '43710155063' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '128' then case when cb.num_cuenta = '43710155071' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '129' then case when cb.num_cuenta = '43710155098' then '902'
                                                                    else cb.unidad_ejecutora end
                             when '130' then case when cb.num_cuenta = '43710155101' then '902'
                                                                    else cb.unidad_ejecutora end
   ELSE
        cb.unidad_ejecutora END unidad
   from 
   (select 
     nombre_cta, num_cuenta, id_cuenta, case unidad_ejecutora when '100' then '109' else unidad_ejecutora end unidad_ejecutora, entidad, ambito, id_tipo_programa 
    from 
     rf_tr_cuentas_bancarias 
    where 
     id_tipo_programa != (select 
                           decode(programa,7,1,7) res 
                          from 
                           (select distinct(id_tipo_programa) programa 
                            from 
                             RF_TR_CUENTAS_BANCARIAS 
                            where 
                             (id_cuenta in (:idCuentas)
                             ))) 
                             
                             and ((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd')) or 
                                                          fecha_fin_operacion is null ) or (fecha_operacion  &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
                                                          fecha_fin_operacion is null ) ) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
                                                          fecha_fin_operacion is null)) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') or fecha_fin_operacion is null)))
                              and id_tipo_cta !=8 and id_tipo_programa in (7,1) 
                              ) cb
                          left join
                           (select 
                             id_cuenta,  SUM(monto) AS rendimientos 
                            from 
                             rf_tr_movimientos_cuenta m, RF_TC_CLAVES_TRANSACCION ct 
                            where
                             fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
                             AND m.id_clave_trans_recla = ct.id_clave_trans and
                             (ct.id_clave_tb = 55)   and id_cuenta in (:idCuentas)
                           group by 
                             id_cuenta) mc 
                          on 
                           cb.id_cuenta = mc.id_cuenta ) r,
                            (select unidad_ejecutora, entidad, ambito, descripcion
                            from rf_tc_unidades_ejecutoras_tece ut
                            union all
                            select unidad_ejecutora, entidad, ambito, descripcion
                            from RF_TC_CLASIFICA_UNIDADES) ue
                          where 
                           r.unidad = ue.unidad_ejecutora AND (r.entidad = ue.entidad) ---- AND r.ambito = ue.ambito 
                          ORDER BY 
                           grupo, num_cuenta
</select>
<select id="RendimientosTodosProgramasBBVA">
select 
 nombre_cta, num_cuenta, rendimientos, ue.descripcion, r.unidad_ejecutora, r.entidad, r.ambito, grupo , unidad, subtotal 
from 
 (select 
   cb.nombre_cta, cb.num_cuenta, nvl(mc.rendimientos,0) rendimientos,  cb.unidad_ejecutora, cb.entidad, cb.ambito, 
   cb.unidad_ejecutora || decode(cb.entidad || cb.ambito,    '91',    '1',    cb.entidad) || cb.ambito grupo, 
   cb.unidad_ejecutora unidad, 
   case when cb.unidad_ejecutora &lt; '121' then 0 
        when cb.unidad_ejecutora = '130' then 0 
   else 1 end subtotal 
   from 
   (select 
     nombre_cta, num_cuenta, id_cuenta, 
     case unidad_ejecutora when '100' then '109' else unidad_ejecutora end unidad_ejecutora, entidad, ambito, id_tipo_programa 
    from 
     rf_tr_cuentas_bancarias 
    where 
     (id_cuenta in (:idCuentas)) and ((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd')) or 
     fecha_fin_operacion is null ) or (fecha_operacion  &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
     fecha_fin_operacion is null ) ) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
     fecha_fin_operacion is null)) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date(':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') or fecha_fin_operacion is null)))
     and id_tipo_cta !=8 and id_tipo_programa = 8 ) cb
    left join
     (select id_cuenta,  SUM(monto) AS rendimientos 
      from rf_tr_movimientos_cuenta 
      where
          fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
          AND id_clave_trans_recla = 1162 
      group by 
          id_cuenta) mc 
      on 
       cb.id_cuenta = mc.id_cuenta ) r, rf_tc_unidades_ejecutoras_tece ue 
  where    
    r.unidad = ue.unidad_ejecutora AND (r.entidad = ue.entidad)  AND r.ambito = ue.ambito 
  ORDER BY 
    grupo, num_cuenta
</select>
<select id="RendimientosTodosProgramasEsp">
   select 
 nombre_cta, num_cuenta, rendimientos, decode(ue.descripcion,'Oficina del C. Presidente','Junta de Gobierno y Presidencia','Organo Interno de Control','Contraloria Interna',ue.descripcion) descripcion, r.unidad_ejecutora, r.entidad, r.ambito,  unidad, 
 decode (r.unidad,'901','0901','902','0902',r.unidad) || decode(r.entidad || r.ambito,    '91',    '1',    r.entidad) || r.ambito grupo,
 case when unidad &lt; '121' then 0 
      when unidad in ('130','901','902') then 0 else 1 end subtotal  
from 
 (select 
   cb.nombre_cta, cb.num_cuenta, nvl(mc.rendimientos,0) rendimientos,  cb.unidad_ejecutora,  
   cb.ambito, cb.entidad, cb.unidad_ejecutora unidad
   from 
   (select 
     nombre_cta, num_cuenta, id_cuenta, 
     unidad_ejecutora, entidad, ambito, id_tipo_programa 
    from 
     rf_tr_cuentas_bancarias 
    where 
     id_tipo_programa != (select 
                           decode(programa,7,1,7) res 
                          from 
                           (select distinct(id_tipo_programa) programa 
                            from 
                             RF_TR_CUENTAS_BANCARIAS 
                            where 
                             (id_cuenta in (:idCuentas)))) 
                             and ((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd')) or 
                                                          fecha_fin_operacion is null ) or (fecha_operacion  &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
                                                          fecha_fin_operacion is null ) ) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
                                                          fecha_fin_operacion is null)) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') or fecha_fin_operacion is null)))
                              and id_tipo_cta !=8 and id_tipo_programa = 9
                              ) cb
                          left join
                           (select 
                             id_cuenta,  SUM(monto) AS rendimientos 
                            from 
                             rf_tr_movimientos_cuenta m, RF_TC_CLAVES_TRANSACCION ct 
                            where
                             fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
                             AND m.id_clave_trans_recla = ct.id_clave_trans and
                             (ct.id_clave_tb = 55)   and id_cuenta in (:idCuentas)
                           group by 
                             id_cuenta) mc 
                          on 
                           cb.id_cuenta = mc.id_cuenta ) r,
                            (select unidad_ejecutora, entidad, ambito, descripcion
                            from rf_tc_unidades_ejecutoras_tece ut
                            union all
                            select unidad_ejecutora, entidad, ambito, descripcion
                            from RF_TC_CLASIFICA_UNIDADES) ue
                          where 
                           r.unidad = ue.unidad_ejecutora AND (r.entidad = ue.entidad) 
                          ORDER BY 
                           grupo, num_cuenta
</select>
<select id="RendimientosTodosProgramasGral">
select 
 nombre_cta, num_cuenta, rendimientos, ue.descripcion, r.unidad_ejecutora, r.entidad, r.ambito, grupo , unidad, subtotal 
from 
 (select 
   cb.nombre_cta, cb.num_cuenta, nvl(mc.rendimientos,0) rendimientos,  cb.unidad_ejecutora, cb.entidad, cb.ambito, 
   cb.unidad_ejecutora  ||  cb.entidad || cb.ambito grupo,
   cb.unidad_ejecutora unidad,
   case when cb.unidad_ejecutora &lt; '121' then 0 when cb.unidad_ejecutora = '130' then 0 else 1 end subtotal 
   from 
   (select 
     nombre_cta, num_cuenta, id_cuenta, 
     unidad_ejecutora, entidad, ambito, id_tipo_programa 
    from 
     rf_tr_cuentas_bancarias 
    where 
       (id_cuenta in (:idCuentas)) and 
       ((fecha_operacion &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd')) or 
         fecha_fin_operacion is null ) or (fecha_operacion  &lt;= to_date(':fechaInicial','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
         fecha_fin_operacion is null ) ) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion >= to_date (':fechaFinal','yyyy-mm-dd') or 
         fecha_fin_operacion is null)) or (fecha_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') and (fecha_fin_operacion BETWEEN to_date(':fechaInicial','yyyy-mm-dd') AND to_date (':fechaFinal','yyyy-mm-dd') or fecha_fin_operacion is null)))
          and id_tipo_cta !=8 and id_tipo_programa in (:programa) ) cb
    left join
    (select 
       id_cuenta,  SUM(monto) AS rendimientos 
     from 
       rf_tr_movimientos_cuenta 
     where
       fecha_hora >= to_date (':fechaInicial','yyyy-mm-dd') AND  fecha_hora &lt; to_date (':fechaFinal','yyyy-mm-dd')+1 
       :clave 
     group by 
       id_cuenta) mc 
    on 
      cb.id_cuenta = mc.id_cuenta ) r,   rf_tc_unidades_ejecutoras_tece ue 
    where   
      r.unidad = ue.unidad_ejecutora AND (r.entidad = ue.entidad)  AND r.ambito = ue.ambito 
    ORDER BY 
      grupo, num_cuenta
</select>
</submodulo>
</dml>